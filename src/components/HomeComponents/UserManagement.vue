<template>
  <div>
    <el-button @click="closePage"> 关闭 </el-button>
    <el-button @click="outLogIn"> 退出登录 </el-button>
    <el-button @click="outNewLogIn"> 刷新登录 </el-button>
    <el-button @click="getLog"> 登录状态 </el-button>
    <el-button @click="toPersonalCenter"> 个人中心 </el-button>
    <el-button @click="toAnonimous"> 游客登录 </el-button>
  </div>
</template>
    
<script setup  >
import { useRouter } from "vue-router";
import {
  reqUserLogState,
  reqLogOut,
  reqNewLogState,
  reqAnonimous,
} from "../../axios/user";
import useUserStore from "../../pinia/user";
import baocunCookie from "../../plugins/ReserveCookie"

// 路由
const router = useRouter();

// Pinia仓库
const userStore = useUserStore();

const emit = defineEmits(["closePage"]);
// 关闭窗口状态
function closePage() {
  emit("closePage");
}

// 退出登录
async function outLogIn() {
  // 清除登录信息
  userStore.ClearLoginInformation();
  document.cookie=""
  // 退出登录接口
  const { data: data } = await reqLogOut();
  console.log(data);
  // 跳转到登录界面
  let pd = confirm("是否跳转到登录界面?");
  // 关闭窗口
  closePage();
  // 判断是否跳转
  if (pd) {
    // 跳转登录
    router.push({
      path: "/log",
    });
  }
}

// 刷新登录
async function outNewLogIn() {
  const { data: data } = await reqNewLogState();
  console.log(data.data);
}

// 查看登录状态
async function getLog() {
  const { data: data } = await reqUserLogState();
  console.log(data.data);
}

// 去个人中心
function toPersonalCenter() {
  router.push({
    path: "/personal_center",
  });
  // 关闭窗口
  closePage();
}
// 游客登录
async function toAnonimous() {
  const { data: data } = await reqAnonimous();
  console.log(data);
  baocunCookie(data.cookie)
}
</script>
    
<style lang="less" scoped>
</style>